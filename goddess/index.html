<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princess Beka's Dominion</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h2>Enter Goddess Password</h2>
            <input type="password" id="goddessPassword" placeholder="Password" autofocus>
            <div class="form-actions">
                <button id="submitPassword" class="btn">Submit</button>
            </div>
            <p id="passwordError" style="color: #f04747; display: none;">Incorrect password. Please try again.</p>
        </div>
    </div>
    <div class="app">
        <div id="errorPopup" class="error-popup">
            <span id="errorMessage"></span>
            <span class="close-error" onclick="hideError()"><svg xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </span>
        </div>

        <!-- Top Bar -->
        <header class="top-bar">
            <div class="logo"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>
                    <path fill='none' stroke='%23e94e77' stroke-width='2'
                        d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z' />
                </svg></div>
            <div class="top-bar-title"></div>
            <div class="quick-stats">
                <span>Slaves: <span id="slaveCount">0</span></span>
                <span>Tasks: <span id="taskCount">0</span></span>
                <span>Points: <span id="totalPoints">0</span></span>
            </div>
            <button id="logoutBtn" class="btn logout">Logout</button>
        </header>

        <!-- Main Layout -->
        <div class="layout">
            <!-- Primary Sidebar -->
            <aside class="primary-sidebar">
                <nav>
                    <button id="overviewBtn" class="nav-btn active" data-section="overview" title="Overview">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                            <path
                                d="M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z" />
                            <path
                                d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z" />
                        </svg>

                        <span>Overview</span>
                    </button>
                    <button id="slavesBtn" class="nav-btn" data-section="slaves" title="Slaves">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                            <path fill-rule="evenodd"
                                d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"
                                clip-rule="evenodd" />
                        </svg>

                        <span>Slaves</span>
                    </button>
                    <button id="managementBtn" class="nav-btn" data-section="management" title="Management">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                            <path fill-rule="evenodd"
                                d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z"
                                clip-rule="evenodd" />
                            <path fill-rule="evenodd"
                                d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z"
                                clip-rule="evenodd" />
                        </svg>

                        <span>Management</span>
                    </button>
                    <button id="communicationBtn" class="nav-btn" data-section="communication" title="Communication">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                            <path fill-rule="evenodd"
                                d="M12 2.25c-2.429 0-4.817.178-7.152.521C2.87 3.061 1.5 4.795 1.5 6.741v6.018c0 1.946 1.37 3.68 3.348 3.97.877.129 1.761.234 2.652.316V21a.75.75 0 0 0 1.28.53l4.184-4.183a.39.39 0 0 1 .266-.112c2.006-.05 3.982-.22 5.922-.506 1.978-.29 3.348-2.023 3.348-3.97V6.741c0-1.947-1.37-3.68-3.348-3.97A49.145 49.145 0 0 0 12 2.25ZM8.25 8.625a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Zm2.625 1.125a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875-1.125a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Z"
                                clip-rule="evenodd" />
                        </svg>
                        <span>Communication</span>
                        <p id="unreadBadge" class="badge" style="display: none;">0</p>
                    </button>
                    <button id="analyticsBtn" class="nav-btn" data-section="analytics" title="Analytics">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                            <path fill-rule="evenodd"
                                d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm4.5 7.5a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25a.75.75 0 0 1 .75-.75Zm3.75-1.5a.75.75 0 0 0-1.5 0v4.5a.75.75 0 0 0 1.5 0V12Zm2.25-3a.75.75 0 0 1 .75.75v6.75a.75.75 0 0 1-1.5 0V9.75A.75.75 0 0 1 13.5 9Zm3.75-1.5a.75.75 0 0 0-1.5 0v9a.75.75 0 0 0 1.5 0v-9Z"
                                clip-rule="evenodd" />
                        </svg>

                        <span>Analytics</span>
                    </button>
                </nav>
            </aside>

            <!-- Secondary Sidebar -->
            <aside class="secondary-sidebar" id="secondarySidebar">
                <!-- Dynamically populated -->
            </aside>

            <!-- Main Content -->
            <main class="main-content" id="mainContent">
                <!-- Overview Section -->
                <section id="overview" class="content-section">
                    <div class="card-grid">
                        <div class="card">Active Slaves: <span id="activeSlaves">0</span></div>
                        <div class="card">Pending Requests: <span id="pendingCount">0</span></div>
                        <div class="card">Total Points: <span id="totalPointsCard">0</span></div>
                        <div class="card">Tasks Completed: <span id="tasksCompleted">0</span></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="pointsChart"></canvas>
                        <canvas id="taskChart"></canvas>
                    </div>
                    <div class="leaderboard">
                        <h3>Top Slaves</h3>
                        <div id="leaderboardList"></div>
                    </div>
                </section>

                <!-- Slaves Section -->
                <section id="slaves" class="content-section">
                    <div id="pendingRequests" class="tab-content">
                        <h3>Pending Requests</h3>
                    </div>
                    <div id="activeSlavesNow" class="tab-content" style="display: none;">
                        <h3>Active Slaves</h3>
                    </div>
                    <div id="blockedSlaves" class="tab-content" style="display: none;">
                        <h3>Blocked Slaves</h3>
                    </div>
                </section>

                <!-- Management Section -->
                <div id="management" class="section" style="display: none;">
                    <div id="tasks" class="tab-content" style="display: flex; flex-direction: column;">
                        <div class="sub-tab-header">
                            <h2>Tasks</h2>
                            <button id="createTaskBtn" class="btn">Create Task</button>
                        </div>
                        <div id="taskForm" class="form-container hidden">
                            <input type="text" id="taskTitle" placeholder="Task Title">
                            <select id="taskCategory">
                                <option value="daily">Daily</option>
                                <option value="challenge">Challenge</option>
                                <option value="punishment">Punishment</option>
                                <option value="custom">Custom</option>
                            </select>
                            <select id="taskPriority">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                            <input type="number" id="taskPoints" placeholder="Points" min="1" max="1000">
                            <input type="datetime-local" id="taskDeadline">
                            <select id="taskSlave">
                                <option value="all">All Slaves</option>
                            </select>
                            <input type="text" id="taskDependencies" placeholder="Dependencies (comma-separated IDs)">
                            <label><input type="checkbox" id="recurringTask"> Recurring</label>
                            <div class="form-actions">
                                <button id="assignTask" class="btn">Assign</button>
                                <button id="saveTaskTemplate" class="btn secondary">Save Template</button>
                                <button id="previewTask" class="btn secondary">Preview</button>
                            </div>
                        </div>
                        <div class="templates-container card" style="display: none;">
                            <h3>Templates</h3>
                            <div id="templateList"></div>
                        </div>
                        <div class="list-container card">
                            <div class="list-header">
                                <h3>Task List</h3>
                                <button id="bulkComplete" class="btn">Mark Selected Complete</button>
                            </div>
                            <div id="taskList" class="sortable"></div>
                        </div>
                    </div>

                    <div id="rewards" class="tab-content">
                        <div class="sub-tab-header">
                            <h2>Rewards</h2>
                            <button id="createRewardBtn" class="btn">Award Reward</button>
                        </div>
                        <div id="rewardForm" class="form-container hidden">
                            <select id="rewardSlave"></select>
                            <input type="number" id="rewardPoints" placeholder="Points" min="1" max="10000">
                            <select id="rewardType">
                                <option value="points">Points</option>
                                <option value="badge">Badge</option>
                                <option value="item">Item</option>
                            </select>
                            <input type="text" id="rewardDescription"
                                placeholder="Description (e.g., Loyal Servant Badge)">
                            <select id="rewardTier">
                                <option value="bronze">Bronze</option>
                                <option value="silver">Silver</option>
                                <option value="gold">Gold</option>
                                <option value="platinum">Platinum</option>
                            </select>
                            <input type="date" id="rewardExpiration">
                            <div class="form-actions">
                                <button id="awardPoints" class="btn">Award</button>
                                <button id="bulkAward" class="btn secondary">Bulk Award</button>
                                <button id="previewReward" class="btn secondary">Preview</button>
                            </div>
                        </div>
                        <div class="list-container card">
                            <h3>Reward History</h3>
                            <div id="rewardList"></div>
                        </div>
                    </div>

                    <div id="training" class="tab-content">
                        <div class="sub-tab-header">
                            <h2>Training</h2>
                            <button id="createLessonBtn" class="btn">Create Lesson</button>
                        </div>
                        <div id="lessonForm" class="form-container hidden">
                            <input type="text" id="lessonTitle" placeholder="Lesson Title">
                            <textarea id="lessonContent" placeholder="Lesson Content (Markdown supported)"></textarea>
                            <input type="datetime-local" id="lessonSchedule">
                            <div id="quizBuilder" class="quiz-container"
                                style="display: flex; flex-direction: column; width: 40%; border-radius: 10px;">
                                <h4>Quiz Questions</h4>
                                <div id="quizQuestions"></div>
                                <input type="text" id="quizQuestion" placeholder="Question">
                                <input type="text" id="quizAnswers" placeholder="Answers (comma-separated)">
                                <input type="number" id="quizCorrect" placeholder="Correct Answer Index" min="0">
                                <button id="addQuiz" class="btn secondary">Add Question</button>
                            </div>
                            <div class="form-actions">
                                <button id="addLesson" class="btn">Publish</button>
                                <button id="previewLesson" class="btn secondary">Preview</button>
                            </div>
                        </div>
                        <div class="list-container card">
                            <h3>Lessons</h3>
                            <div id="lessonList"></div>
                        </div>
                    </div>

                    <div id="marketplace" class="tab-content">
                        <div class="sub-tab-header">
                            <h2>Marketplace</h2>
                            <button id="createItemBtn" class="btn">Add Item</button>
                        </div>
                        <div id="itemForm" class="form-container hidden">
                            <input type="text" id="itemName" placeholder="Item Name">
                            <select id="itemCategory">
                                <option value="gear">Gear</option>
                                <option value="privilege">Privilege</option>
                                <option value="cosmetic">Cosmetic</option>
                            </select>
                            <input type="number" id="itemCost" placeholder="Cost (Points)" min="1">
                            <input type="number" id="itemStock" placeholder="Stock" min="1">
                            <input type="number" id="itemDiscount" placeholder="Discount (%)" min="0" max="100">
                            <label><input type="checkbox" id="itemBiddable"> Allow Bidding</label>
                            <input type="file" id="itemImage" accept="image/*">
                            <div class="form-actions">
                                <button id="addItem" class="btn">Add</button>
                                <button id="previewItem" class="btn secondary">Preview</button>
                            </div>
                        </div>
                        <div class="list-container card">
                            <div class="list-header">
                                <h3>Shop Items</h3>
                                <input type="text" id="marketFilter" placeholder="Filter by name...">
                            </div>
                            <div id="shopItems" style="display: flex; flex-direction: column; width: 40%;"></div>
                        </div>
                    </div>

                    <div id="events" class="tab-content">
                        <div class="sub-tab-header">
                            <h2>Events</h2>
                            <button id="createEventBtn" class="btn">Create Event</button>
                        </div>
                        <div id="eventForm" class="form-container hidden">
                            <input type="text" id="eventTitle" placeholder="Event Title">
                            <select id="eventType">
                                <option value="celebration">Celebration</option>
                                <option value="competition">Competition</option>
                                <option value="announcement">Announcement</option>
                            </select>
                            <textarea id="eventDescription" placeholder="Event Description"></textarea>
                            <input type="datetime-local" id="eventEndDate">
                            <select id="eventRecurring">
                                <option value="none">One-Time</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                            <label><input type="checkbox" id="eventReminder"> Send Reminder</label>
                            <div class="form-actions">
                                <button id="createEvent" class="btn">Create</button>
                                <button id="previewEvent" class="btn secondary">Preview</button>
                            </div>
                        </div>
                        <div class="list-container card">
                            <h3>Events</h3>
                            <div id="eventList"></div>
                        </div>
                    </div>

                    <!-- Preview Modal -->
                    <div id="previewModal" class="modal hidden">
                        <div class="modal-content">
                            <h3 id="previewTitle"></h3>
                            <div id="previewBody"></div>
                            <button id="closePreview" class="btn logout">Close</button>
                        </div>
                    </div>
                </div>

                <!-- Communication Section -->
                <section id="communication" class="content-section" style="display: none; padding: 0;">
                    <div id="chat" class="tab-content" style="padding: 0;">
                        <div class="chat-layout" style="padding: 0;">
                            <aside class="chat-sidebar">
                                <div class="chat-list" id="chatList"></div>
                            </aside>
                            <div class="chat-main">
                                <div class="chat-header" id="chatHeader">
                                    <div class="profile-circle" id="chatProfileCircle"></div>
                                    <span id="chatRecipientName">Select a chat</span>
                                </div>
                                <div id="chatMessages" class="chat-box"></div>
                                <div class="chat-input">
                                    <input type="text" id="chatInput" placeholder="Command your slaves...">
                                    <button id="sendMessage" class="btn send-btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="size-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                                        </svg>

                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="groupChat" class="tab-content"
                        style="display: none; border-radius: 0; padding: 20px; gap: 15px;">
                        <h3>Group Chats</h3>
                        <div class="form">
                            <input type="text" id="groupChatName" placeholder="Group Name">
                            <button id="createGroupChat" class="btn">Create</button>
                        </div>
                        <div id="groupChatList"></div>
                    </div>
                    <div id="commands" class="tab-content"
                        style="display: none; border-radius: 0; padding: 20px; gap: 15px;">
                        <h3>Commands</h3>
                        <div class="form">
                            <input type="text" id="commandInput" placeholder="Issue a divine command...">
                            <button id="sendCommand" class="btn">Proclaim</button>
                        </div>
                        <div id="commandList"></div>
                    </div>
                    <div id="announcements" class="tab-content"
                        style="display: none; border-radius: 0; padding: 20px; gap: 15px;">
                        <h3>Announcements</h3>
                        <div class="form">
                            <input type="text" id="announcementInput" placeholder="Announce to all...">
                            <input type="datetime-local" id="announcementSchedule" placeholder="Schedule">
                            <button id="sendAnnouncement" class="btn">Announce</button>
                        </div>
                        <div id="announcementList"></div>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics" class="content-section" style="display: none;">
                    <div class="card-grid">
                        <div class="card">Avg Points/Slave: <span id="avgPoints">0</span></div>
                        <div class="card">Task Completion Rate: <span id="completionRate">0%</span></div>
                        <div class="card">Most Active Slave: <span id="mostActive"></span></div>
                        <div class="card">Total Messages: <span id="totalMessages">0</span></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="slaveActivityChart"></canvas>
                        <canvas id="pointsTrendChart"></canvas>
                    </div>
                    <button id="exportReport" class="btn">Export Report</button>
                </section>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="notifications" id="notifications"></div>
        </footer>

        <!-- Slave Stats Modal -->
        <div id="slaveStatsModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeSlaveStatsModal()">×</span>
                <h2 id="slaveStatsName">Slave Stats</h2>
                <div id="slaveStatsContent" class="stats-grid"></div>
                <div id="slaveHistory" class="history-list"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- Shared Scripts -->
    <script src="../shared/firebase-config.js"></script>
    <script src="../shared/auth.js"></script>
    <script src="../shared/db.js"></script>
    <script src="../shared/modal.js"></script>
    <!-- External Libraries -->
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
    <script src="./script.js"></script>
</body>

</html>